<!DOCTYPE html>
<html>
<head>
	<title> Mustafa Kocumoglu </title>
	<link rel="stylesheet" href="css/style.css">
</head>
<body>
	<div class="game">
		<div class="gameScore">SCORE : <span>0</span></div>
		<div class="gameMessage">KAZANDINIZ!</div>
	</div>
	<canvas id="canvas" width="750" height="400" style="border: 5px solid #000"> </canvas>

	<script>
	let c = document.getElementById('canvas');
	let ctx = c.getContext('2d');
	let tileSize = 50;
	let moves = 0;

	let map= [[0,0,1,0,0,0,1,0,1,0,1,0,1,0,2],
			  [1,0,1,0,1,0,1,0,1,0,0,0,1,0,1],
			  [1,0,0,0,1,0,1,0,0,0,1,0,1,0,1],
			  [1,0,1,0,1,0,0,0,1,0,1,0,1,0,1],
			  [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],
			  [1,0,0,0,1,0,0,0,0,0,1,0,0,0,1],
			  [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],
			  [1,0,1,0,1,0,0,0,1,0,0,0,1,0,1]];

	let collBox = [];
	let mapLength = map[0].length;
	let mapHeight = map.length;
	
	let tugla = new Image();
	tugla.src = 'img/tugla.jpg';
	
	let elma = new Image();
	elma.src = 'img/elma.jpg';
	
	let zemin = new Image();
	zemin.src = 'img/zemin.jpg';
	
	let domuz = new Image();
	domuz.src = 'img/domuz.jpg';
	
	function drawMap(m){
		for(i=0; i<m.length; i++){
			collBox.push([]);
			for(j=0; j<m[i].length; j++){
				if(m[i][j]===1){
					ctx.beginPath();
					//ctx.fillStyle= "#000000";
					//ctx.fillRect(j*tileSize,i*tileSize,tileSize,tileSize);
					ctx.drawImage(tugla, j*tileSize , i*tileSize , tileSize , tileSize);
					        
				}
				else if(m[i][j]===2){
					ctx.beginPath();
					//ctx.fillStyle= "#00ff00";
					//ctx.fillRect(j*tileSize,i*tileSize,tileSize,tileSize);
					ctx.drawImage(elma, j*tileSize , i*tileSize , tileSize , tileSize);
				}
				else {
				ctx.beginPath();
				ctx.drawImage(zemin, j*tileSize , i*tileSize , tileSize , tileSize);
				}
				collBox[i].push({x:j*tileSize, y:i*tileSize, status: m[i][j] === 1 ? 1 : (m[i][j] === 2 ? 2: 0)});
			}
		}
	}
	
	function drawPlayer(x,y){
		ctx.beginPath();
		//ctx.fillStyle = "#FF0000";
		//ctx.fillRect(x,y,tileSize,tileSize);
		ctx.drawImage(domuz, x, y, tileSize , tileSize);
	}
	
	function move(x,y){
		ctx.clearRect(0, 0,mapLength*tileSize,mapHeight*tileSize);
		drawMap(map);
		drawPlayer(x,y);
		
		player.x = player.newX;
		player.y = player.newY;
		
		moves = moves+1;
		document.querySelector(".gameScore span").innerHTML = moves;
	}
	
	let player = {
		x: 0,
		y: 0,
		newX: 0,
		newY: 0
	}
	function checkColl(){
		for(i=0; i<mapHeight; i++){
			for(j=0; j<mapLength; j++){
				let b = collBox[i][j];
				
				if(player.newX === b.x && player.newY === b.y){
					if(b.status === 1){
						console.log('Hit Rock');
					}
					else if(b.status === 2 ){
						console.log('WIN');
						move(player.newX, player.newY);
						document.querySelector(".gameMessage").style.display = "block";
					}
					else{
					  move(player.newX, player.newY);
					}
				}
				else if(player.newX < 0 || player.newX >= mapLength*tileSize || player.newY <0 || player.newY >= mapHeight*tileSize){
					console.log('Hit Wall');0
				}
			}
		}
	}
	
	window.onkeydown = function(e){
		if(e.keyCode=== 37){player.newX = player.x - tileSize; player.newY = player.y; console.log('SOL');}
		if(e.keyCode=== 38){player.newY = player.y - tileSize; player.newX = player.x; console.log('YUKARI');}
		if(e.keyCode=== 39){player.newX = player.x + tileSize; player.newY = player.y; console.log('SAG');}
		if(e.keyCode=== 40){player.newY = player.y + tileSize; player.newX = player.x; console.log('ASAGI');}	
		checkColl();
	}
		
		
		
	window.onload = function(){
		drawMap(map);
		drawPlayer(0, 0);
//console.log(collBox);
	}

	</script>
</body>
</html>
